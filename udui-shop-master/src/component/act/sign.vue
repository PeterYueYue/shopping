<style scoped>
body {
    background: #ffd202;
}

.signUpTop {
    height: 5.31rem;
    background: url('../../assets/images/subject/sign/signUptopbg.jpg') no-repeat;
    background-size: 100% 100%;
    overflow: hidden;
}

.signUpTop .showRule {
    display: inline-block;
    padding: 1px 0.18rem;
    border-top-right-radius: 0.3rem;
    border-bottom-right-radius: 0.3rem;
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    font-size: 0.24rem;
}

.signuprecord {
    float: right;
    padding: 1px 0.18rem;
    border-top-left-radius: 0.3rem;
    border-bottom-left-radius: 0.3rem;
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    font-size: 0.24rem;
}

.signuprecord a {
    color: #fff;
}

.signUpWinShow {
    margin-top: 0.3rem;
    text-align: center;
    overflow: hidden;
    height: 0.6rem;
}

.signUpWinShow span {
    display: inline-block;
    padding: 0 0.3rem;
    height: 0.6rem;
    max-width: 4.8rem;
    line-height: 0.6rem;
    border-radius: 0.3rem;
    font-size: 0.24rem;
    color: #666;
    background: #fffacf;
    overflow: hidden;
}

.signUpWinShow ul {
    position: relative;
}

.signUpBtn {
    width: 1.8rem;
    height: 1.8rem;
    margin: 2.1rem auto 0;
}

.signUpBtn.active {
    background: url('../../assets/images/subject/sign/signUpBtn.png') no-repeat;
    background-size: 100% 100%;
}

.signUpBtn.disable {
    background: url('../../assets/images/subject/sign/signUpBtnOff.png') no-repeat;
    background-size: 100% 100%;
}

.signUpRec {
    padding: 0 0.54rem;
    background: #841dad;
    height: 3.828rem;
    background: url('../../assets/images/subject/sign/signuprec.jpg') no-repeat;
    background-size: 100% 100%;
}

.signUpRec h3 {
    height: 0.42rem;
    line-height: 0.42rem;
    background: url('../../assets/images/subject/sign/signUpTit.jpg') left 0.03rem no-repeat;
    background-size: auto 0.36rem;
}

.signUpRec h3 a {
    font-weight: normal;
    font-size: 0.216rem;
    float: right;
    margin-left: 0.12rem;
    padding: 0 0.18rem;
    background: #fff;
    border-radius: 0.15rem;
}

.toMyAct a {
    color: #000;
}

.signdays {
    height: 0.48rem;
    line-height: 0.48rem;
    padding-top: 0.54rem;
}

.signdays .fl {
    font-size: 0.3rem;
    color: #b746dc;
    font-weight: bold;
}

.signdays .fl b {
    color: #fed40b;
    margin: 0 0.06rem;
}

.signdays .fr {
    width: 1.26rem;
    text-align: center;
    color: #000;
    font-size: 0.24rem;
    font-weight: normal;
    background: url('../../assets/images/subject/sign/tomyact.jpg') no-repeat;
    background-size: 100% 100%;
}

.signUpIco {
    margin-top: 0.12rem;
}

.signUpIco>div {
    float: left;
    width: 0.917rem;
    height: 0.9rem;
    background: url('../../assets/images/subject/sign/signIco.jpg') right bottom no-repeat;
    background-size: 0.87rem auto;
}

.signUpIco .winIco {
    background-position: 0 -0.72rem;
}

.signUpIco .winIco.active {
    background-position: 0 0.09rem;
}

.signUpIco .winIcoFinal {
    background-position: 0.09rem -2.7rem;
}

.signUpIco .winIcoFinal.active {
    background-position: 0.09rem -1.68rem;
}

.signUpLine {
    height: 0.18rem;
    border: 4px solid #841dad;
    border-radius: 0.18rem;
    background: #e7e6e6;
    overflow: hidden;
    box-shadow: 1px 1px 3px #aaa;
}

.signUpLine p {
    width: 0;
    height: 100%;
    background: url('../../assets/images/subject/sign/signupschebg.jpg') repeat-x;
    background-size: auto 100%;
}

.signUpLineInfo {
    float: left;
    position: relative;
    width: 0.917rem;
    height: 0.3rem;
}

.signUpLineDot {
    position: absolute;
    right: 0;
    top: 0.06rem;
    width: 0.156rem;
    height: 0.156rem;
    border-radius: 0.08rem;
    background: #ffd202;
}

.signUpLineTxt {
    position: absolute;
    top: 0.24rem;
    right: 0;
}

.signUpDays {
    margin: 0.6rem 0 0;
    text-align: center;
    color: #841dad;
    font-size: 0.36rem;
    font-weight: bold;
}

.signUpDays b {
    margin: 0 0.06rem;
    color: #ffd202;
}

.signBottom {
    background: #eee;
}

.signBottom h1 {
    height: 0.48rem;
    line-height: 0.48rem;
    background: #fff;
    font-size: 0.3rem;
    color: #841dad;
    text-align: center;
    font-weight: normal;
}

.signBottom h1 i {
    margin-left: 0.06rem;
    font-size: 0.24rem;
}

.signAd1 img {
    display: block;
    width: 100%;
}

.signBottom h3 {
    height: 0.336rem;
    margin: 0.6rem 0;
    background: url('../../assets/images/subject/sign/signbottomh3.jpg') center no-repeat;
    background-size: 6.6rem 0.336rem;
}

.signAd2 {
    padding: 0 0.18rem 0.54rem;
}

.signAd2 li {
    float: left;
    width: 3.456rem;
    height: 1.404rem;
    background: #fff;
    margin-bottom: 0.168rem;
}

.signAd2 li:nth-child(2n+1) {
    margin-right: 0.168rem;
}

.signAd2 li img {
    display: block;
    width: 100%;
    height: 100%;
}

.signOkPop {
    width: 6.45rem;
    height: 9rem;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    -webkit-transform: translate(-50%, -50%);
    z-index: 11;
    background: url('../../assets/images/subject/sign/signokpop.png') center no-repeat;
    background-size: 100% 100%;
}

.signOkPop.day7 {
    background-image: url('../../assets/images/subject/sign/signokpop7.png');
}

.signOkPop p {
    position: absolute;
    top: 4.44rem;
    left: 2.16rem;
    text-align: center;
    color: #962a0b;
    font-size: 0.84rem;
}

.signOkPop span {
    display: block;
    width: 4.65rem;
    text-align: center;
    height: 1.2rem;
    line-height: 1.2rem;
    position: absolute;
    bottom: 0.3rem;
    font-size: 0.36rem;
    left: 0.9rem;
    color: #8b1508;
}

.signOkPop span b {
    margin: 0 0.12rem 0 0;
    font-weight: normal;
    font-size: 0.39rem;
}

.signRulePop {
    width: 6.15rem;
    position: absolute;
    left: 50%;
    top: 1.2rem;
    transform: translate(-50%, 0);
    -webkit-transform: translate(-50%, 0);
    z-index: 11;
    background: #fff;
    border-radius: 0.12rem;
    overflow: hidden;
}

.signRulePop h3 {
    height: 1.02rem;
    line-height: 1.02rem;
    text-align: center;
    position: relative;
    font-size: 0.36rem;
    color: #fff;
    background-image: -webkit-linear-gradient(top, #ad2aea, #8006c0);
}

.signRulePop h3 i {
    position: absolute;
    display: block;
    width: 0.42rem;
    height: 0.42rem;
    line-height: 0.42rem;
    right: 0.18rem;
    top: 0.3rem;
    font-size: 0.42rem;
}

.signRulePop .ruleTxt {
    padding: 0.48rem 0.36rem;
}

.signRulePop .ruleTxt p {
    line-height: 2;
}

.signRulePop .ruleTxt p.tip {
    margin-top: 0.48rem;
    color: #8006c0;
}
</style>
<template>
<div>
    <div class="signUpTop">
        <div class="signUpWinShow swiper-container">
            <ul class="scrollbox swiper-wrapper">
                <li class="swiper-slide" v-for="data in scrollWinRecord"><span>{{data}}</span></li>
            </ul>
        </div>
        <div :class="[sign.signInfo.todaySign?'disable':'active', 'signUpBtn']" @click="signUp()"></div>
        <div class="showRule" @click="showRulePop()">活动规则</div>
        <div class="signuprecord">
            <router-link to="/sign/myrecord">中奖记录</router-link>
        </div>
    </div>
    <div class="signUpRec">
        <div class="signdays clearfix">
            <div class="fl" v-if="sign.signInfo.serialDays<7">距离豪华礼包还差<b>{{7-sign.signInfo.serialDays}}</b>天</div>
            <div class="fl" v-if="sign.signInfo.serialDays==7">领完奖品明天再来一轮吧</div>
            <div v-if="sign.lotteryChance>0" class="fr toMyAct">
                <router-link to="/index">点我抽奖</router-link>
            </div>
        </div>
        <div class="signUpSche">
            <div class="signUpIco clearfix">
                <div class="winIco" :class="{'active':sign.signInfo.serialDays==1}"></div>
                <div class="winIco" :class="{'active':sign.signInfo.serialDays==2}"></div>
                <div class="winIco" :class="{'active':sign.signInfo.serialDays==3}"></div>
                <div class="winIco" :class="{'active':sign.signInfo.serialDays==4}"></div>
                <div class="winIco" :class="{'active':sign.signInfo.serialDays==5}"></div>
                <div class="winIco" :class="{'active':sign.signInfo.serialDays==6}"></div>
                <div class="winIcoFinal" :class="{'active':sign.signInfo.serialDays==7}"></div>
            </div>
            <div class="signUpLineBox">
                <div class="signUpLine">
                    <p :style="{'width':sign.signInfo.serialDays/7*100+'%'}"></p>
                </div>
                <div class="clearfix">
                    <div class="signUpLineInfo">
                        <div class="signUpLineDot"></div>
                        <div class="signUpLineTxt">1天</div>
                    </div>
                    <div class="signUpLineInfo">
                        <div class="signUpLineDot"></div>
                        <div class="signUpLineTxt">2天</div>
                    </div>
                    <div class="signUpLineInfo">
                        <div class="signUpLineDot"></div>
                        <div class="signUpLineTxt">3天</div>
                    </div>
                    <div class="signUpLineInfo">
                        <div class="signUpLineDot"></div>
                        <div class="signUpLineTxt">4天</div>
                    </div>
                    <div class="signUpLineInfo">
                        <div class="signUpLineDot"></div>
                        <div class="signUpLineTxt">5天</div>
                    </div>
                    <div class="signUpLineInfo">
                        <div class="signUpLineDot"></div>
                        <div class="signUpLineTxt">6天</div>
                    </div>
                    <div class="signUpLineInfo">
                        <div class="signUpLineDot"></div>
                        <div class="signUpLineTxt">7天</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="signBottom">
        <h1>猜你喜欢<i class="iconfont icon-down"></i></h1>
        <div class="signAd1">
            <router-link :to="sign.ad[0].list[0].linkedUrl"><img :src="sign.ad[0].list[0].linkedImg" /></router-link>
        </div>
        <h3></h3>
        <ul class="signAd2 clearfix">
            <li>
                <router-link to="/specialAct/230/part/0/?from=fenzhong">
                    <img src="../../assets/images/subject/sign/signad2-1.jpg" />
                </router-link>
            </li>
            <li>
                <router-link to="/specialAct/151/part/0/?from=fenzhong">
                    <img src="../../assets/images/subject/sign/signad2-2.jpg" />
                </router-link>
            </li>
            <li>
                <router-link to="/specialAct/156/part/0/?from=fenzhong">
                    <img src="../../assets/images/subject/sign/signad2-3.jpg" />
                </router-link>
            </li>
            <li>
                <router-link to="/specialAct/230/part/0/?from=fenzhong">
                    <img src="../../assets/images/subject/sign/signad2-4.jpg" />
                </router-link>
            </li>
        </ul>
    </div>
    <div class="signRulePop" v-if="showRule">
        <h3>活动规则<i class="iconfont icon-roundclosefill" @click="showRulePop()"></i></h3>
        <div class="ruleTxt">
            <p>1、活动期间，每人每天可签到1次，签到后可获得68元优券和1次日常抽奖机会；</p>
            <p>2、每连续签到7天，第7天可参与1次专享抽奖活动。两个抽奖活动不同时享受；</p>
            <p>3、奖品包含超低折扣实体奖品和优券；</p>
            <p>4、优券是优兑商城特有的购物抵用券，可在优兑商城以及线下加盟店购物抵现使用，1券=1元，不转赠，不提现。可关注微信【优兑商城】登录个人中心查看；</p>
            <p>5、如有未使用抽奖机会，可点击页面“点我抽奖”按钮完成抽奖；</p>
            <p>6、点击“中奖纪录”可查看抽中的奖品；</p>
            <p>7、客服咨询热线：400-080-1111</p>
            <p class="tip">天天签到，好运连连哦~</p>
        </div>
    </div>
    <div class="signOkPop" v-if="showSignOk" :class="[sign.serialDays==7?'day7':'dayother']">
        <p>{{sign.voucher}}</p><span><b>{{signOkCd}}</b>秒后带你去抽奖</span>
    </div>
    <layer v-if="showPop"></layer>
</div>
</template>

<script>
import {
    mapGetters
}
from 'vuex'

import layer from './../common/layer.vue'
import swiper from '../../../static/swiper-3.4.0.min'

const components = {
    layer
}
export default {
    data() {
        return {
            showRule:false,
            showPop:false,
            showSignOk:false,
            signOkCd:3
        }
    },
    computed: {
        ...mapGetters({ //
            sign: 'sign'
        }),
        scrollWinRecord: function() {
            let recArr = [],
                recHtmlArr = [];
            if (this.sign.winRecord.bigAwards != null) {
                for (let i = 0; i < this.sign.winRecord.bigAwards.length; i++) {
                    recArr.push(this.sign.winRecord.bigAwards[i]);
                }
            }
            for (let j = 0; j < this.sign.winRecord.smallAwards.length; j++) {
                recArr.push(this.sign.winRecord.smallAwards[j]);
            }
            for (let n = 0; n < recArr.length; n++) {
                recHtmlArr.push(recArr[n].userLogin + ' 刚刚抽中' + recArr[n].giftName);
            }
            return recHtmlArr;
        }
    },
    methods: {
        signUp: function() {
            let that = this;
            if (!this.sign.signInfo.todaySign) {
                this.$store.dispatch('sign').then(function(res){
                    that.signOk(res);
                },function(){})
            }
        },
        showRulePop:function(){
            this.showRule = !this.showRule;
            this.showPop = this.showRule;
        },
        signOk:function(res){
            let that = this;
            let serialDays = res.serialDays;
            this.showSignOk = true;
            this.showPop = this.showSignOk;
            for(var i=0;i<4;i++){
				var j = 0;
				setTimeout(function(){
					if(j>=3){
                        if(serialDays<7){
                            that.$router.push('/discountStreet/ZKJ_FZCM/areaId/0');
                        }else {
                            that.$router.push('/brt/ZP_FZCM/areaId/0');
                        }
					}
					that.signOkCd = (3-j);
					j++;
				},1000*i);
			}
        }
    },
    mounted: function() {
        this.$nextTick(function() {
            let mySwiper = new Swiper(
                '.swiper-container', {
                    direction: 'vertical',
                    autoplay: 1000,
                    observer: true, //修改swiper自己或子元素时，自动初始化swiper
                    observeParents: true,
                    loop: true
                }
            )
        })
    },
    components:components,
    created() {
        this.$store.dispatch('setSignWinRecord', {
            activityCode: 'ZKJ_FZCM',
            topCount: 20,
            priceLine: ''
        });
        this.$store.dispatch('setSignInfo');
        this.$store.dispatch('setSignAd', {
            regionId: -1,
            type: 2,
            appLinkId: 'FZ_QD'
        });
        this.$store.dispatch('checkSignLotteryChance', {
            activityCode: ['ZKJ_FZCM', 'ZP_FZCM'],
            sameCityId: ''
        });
    }
}
</script>
